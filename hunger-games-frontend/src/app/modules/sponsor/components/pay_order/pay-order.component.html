<app-header></app-header>

<h1>Оплата ресурсов для трибута {{this.tribute?.name}}</h1>

<mat-horizontal-stepper #stepper [linear]="true">
    <mat-step label="Выбор ресурсов">
        <table mat-table [dataSource]="orders" style="width: 100%;" class="mat-elevation-z8">
            <ng-container matColumnDef="resources">
                <th mat-header-cell *matHeaderCellDef> Ресурсы </th>
                <td mat-cell *matCellDef="let element">
                    <mat-list>
                        <mat-list-item *ngFor="let resource of element.resources"> {{resource.size}}X {{resource.name}}</mat-list-item>
                    </mat-list>
                </td>
            </ng-container>

            <ng-container matColumnDef="total">
                <th mat-header-cell *matHeaderCellDef> Сумма </th>
                <td mat-cell *matCellDef="let element">
                    {{total(element.resources)}}$
                </td>
            </ng-container>
        
            <ng-container matColumnDef="action">
                <th mat-header-cell *matHeaderCellDef class="header-align-right"></th>
                <td mat-cell *matCellDef="let element">
                    <button mat-raised-button (click)="pay(element)"> Оплатить </button>
                </td>
            </ng-container>
        
            <tr mat-header-row *matHeaderRowDef="ordersColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: ordersColumns;"></tr>
        </table>

    </mat-step>
    <mat-step label="Подтверждение">
        <ng-container *ngIf="this.paymentSucceded === undefined">
            <h2>Ожидаем подверждения оплаты.</h2>

            <button mat-raised-button (click)="pay(this.order!)"> Попробовать еще раз</button>
        </ng-container>
        <ng-container *ngIf="this.paymentSucceded === false">
            <h2>Ошибка оплаты</h2>

            <div>
                <button mat-raised-button (click)="pay(this.order!)">Повторить</button>
                <button mat-raised-button (click)="this.stepper.previous()">Выбрать другие ресурсы</button>
                <button mat-raised-button (click)="this.stepper.previous(); this.stepper.previous()">Выбрать другого трибута</button>
                <button mat-raised-button [routerLink]="['/sponsor/']">Отменить</button>
            </div>
        </ng-container>
        <ng-container *ngIf="this.paymentSucceded === true">
            <h2>Оплата подтверждена</h2>

            <button mat-raised-button [routerLink]="['/sponsor/']">Вернуться</button>
        </ng-container>
    </mat-step>
</mat-horizontal-stepper>